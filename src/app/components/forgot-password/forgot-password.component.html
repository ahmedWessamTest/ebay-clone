<app-nav-auth></app-nav-auth>
<section class="py-8">
  <div class="flex justify-center content-center">
    <div class="flex justify-center">
      <div class="min-w-96">
        <h1 class="text-3xl text-center font-bold pb-4 text-[#191919]">
          Reset Email
        </h1>
        @if(steps() === 1){
        <form [formGroup]="emailValidation" (ngSubmit)="emailSubmit()">
          <div class="relative pb-4">
            <input
              type="text"
              id="email"
              class="block rounded-lg px-2 pb-2 pt-3 w-full text-sm text-gray-900 bg-gray-50 appearance-none focus:outline-none focus:ring-0 focus:border-2 focus:border-black peer"
              [class.border-red-700]="
                emailValidation.get('email')?.errors &&
                (emailValidation.get('email')?.touched ||
                  emailValidation.get('email')?.dirty)
              "
              placeholder=" "
              formControlName="email"
            />
            <label
              for="email"
              class="absolute text-sm text-gray-500 duration-300 transform -translate-y-4 scale-75 top-3 z-10 origin-[0] start-2.5 peer-focus:text-gray-400 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-3 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto"
              >Email</label
            >
            @if(emailValidation.get('email')?.getError('required') &&
            (emailValidation.get('email')?.touched)){
            <p class="text-red-700 text-xs">please enter your email address</p>
            } @else if(emailValidation.get('email')?.getError('minLength') &&
            emailValidation.get('email')?.dirty){
            <p class="text-red-700 text-xs">
              Email address should be at least 6 characters.
            </p>
            } @else if (emailValidation.get('email')?.getError('email') &&
            emailValidation.get('email')?.dirty) {
            <p class="text-red-700 text-xs">
              Email address is invalid. Please enter a valid email address.
            </p>
            }
          </div>
          <button
            class="text-center block w-full rounded-full py-2.5 font-bold text-white bg-[#3665f3] hover:bg-[#0F2796] disabled:bg-[#c7c7c7] disabled:cursor-not-allowed"
            type="submit"
            [disabled]="emailValidation.invalid && !isLoading"
          >
            Confirm
          </button>
          @if(isLoading()){
            <span class="block text-center mt-4">
            <i class="fa-solid fa-spinner fa-spin-pulse"></i>
          </span>
          } @else if (errorMsg()){
          <div
            class="p-4 mt-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400"
            role="alert"
          >
            {{ errorMsg() }}
          </div>
          } @else if (successMsg()) {
          <div
            class="p-4 mt-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400"
            role="alert"
          >
            valid email
          </div>
          }
        </form>
        } @else if(steps() === 2) {
        <form [formGroup]="codeValidation" (ngSubmit)="codeSubmit()">
          <div class="relative pb-4">
            <input
              type="text"
              id="resetCode"
              class="block rounded-lg px-2 pb-2 pt-3 w-full text-sm text-gray-900 bg-gray-50 appearance-none focus:outline-none focus:ring-0 focus:border-2 focus:border-black peer"
              [class.border-red-700]="
                codeValidation.get('resetCode')?.errors &&
                (codeValidation.get('resetCode')?.touched ||
                  codeValidation.get('resetCode')?.dirty)
              "
              placeholder=" "
              formControlName="resetCode"
            />
            <label
              for="resetCode"
              class="absolute text-sm text-gray-500 duration-300 transform -translate-y-4 scale-75 top-3 z-10 origin-[0] start-2.5 peer-focus:text-gray-400 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-3 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto"
              >Reset Code</label
            >
            @if(codeValidation.get('resetCode')?.getError('required') &&
            (codeValidation.get('resetCode')?.touched)){
            <p class="text-red-700 text-xs">please enter your reset code</p>
            } @else if(codeValidation.get('resetCode')?.getError('numeric') &&
            codeValidation.get('resetCode')?.dirty){
            <p class="text-red-700 text-xs">
              numbers only
            </p>
            }
            @else if(codeValidation.get('resetCode')?.getError('codeLength') &&
            codeValidation.get('resetCode')?.dirty){
            <p class="text-red-700 text-xs">
              reset code 6 digits
            </p>
            }
          </div>
          <button
            class="text-center block w-full rounded-full py-2.5 font-bold text-white bg-[#3665f3] hover:bg-[#0F2796] disabled:bg-[#c7c7c7] disabled:cursor-not-allowed"
            type="submit"
            [disabled]="emailValidation.invalid && !isLoading"
          >
            Confirm
          </button>
          @if(isLoading()){
          <span class="block text-center mt-4">
            <i class="fa-solid fa-spinner fa-spin-pulse"></i>
          </span>
          } @else if (errorMsg()){
          <div
            class="p-4 mt-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400"
            role="alert"
          >
            {{ errorMsg() }}
          </div>
          } @else if (successMsg()) {
          <div
            class="p-4 mt-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400"
            role="alert"
          >
            logged in successful
          </div>
          }
        </form>
        } @else if (steps() === 3) {
        <form [formGroup]="ResetPassForm" (ngSubmit)="resetPasswordSubmit()">
          <div class="relative pb-4">
            <input
              readonly
              type="text"
              id="email"
              class="block rounded-lg px-2 pb-2 pt-3 w-full text-sm text-gray-900 bg-gray-50 appearance-none focus:outline-none focus:ring-0 focus:border-2 focus:border-black peer"
              [class.border-red-700]="
                emailValidation.get('email')?.errors &&
                (emailValidation.get('email')?.touched ||
                  emailValidation.get('email')?.dirty)
              "
              placeholder=" "
              formControlName="email"
            />
            <label
              for="email"
              class="absolute text-sm text-gray-500 duration-300 transform -translate-y-4 scale-75 top-3 z-10 origin-[0] start-2.5 peer-focus:text-gray-400 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-3 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto"
              >Email</label
            >
            @if(emailValidation.get('email')?.getError('required') &&
            (emailValidation.get('email')?.touched)){
            <p class="text-red-700 text-xs">please enter your email address</p>
            } @else if(emailValidation.get('email')?.getError('minLength') &&
            emailValidation.get('email')?.dirty){
            <p class="text-red-700 text-xs">
              Email address should be at least 6 characters.
            </p>
            } @else if (emailValidation.get('email')?.getError('email') &&
            emailValidation.get('email')?.dirty) {
            <p class="text-red-700 text-xs">
              Email address is invalid. Please enter a valid email address.
            </p>
            }
          </div>
          <div class="relative pb-4">
              <input
                type="password"
                id="newPassword"
                class="block rounded-lg px-2 pb-2 pt-3 w-full text-sm text-gray-900 bg-gray-50 appearance-none focus:outline-none focus:ring-0 focus:border-2 focus:border-black peer"
                [class.border-red-700]="
                  ResetPassForm.get('newPassword')?.errors &&
                  ResetPassForm.get('newPassword')?.touched
                "
                placeholder=" "
                formControlName="newPassword"
              />
              <label
                for="newPassword"
                class="absolute text-sm text-gray-500 duration-300 transform -translate-y-4 scale-75 top-3 z-10 origin-[0] start-2.5 peer-focus:text-gray-400 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-3 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto"
                >new password</label
              >
              @if(ResetPassForm.get('newPassword')?.getError('required') &&
              ResetPassForm.get('newPassword')?.touched &&
              (!ResetPassForm.get('newPassword')?.dirty ||
              !ResetPassForm.get('newPassword')?.value)){
              <p class="text-red-700 text-xs peer-focus:hidden">
                Please enter a newPassword.
              </p>
              } @else if (ResetPassForm.get('newPassword')?.errors &&
              (ResetPassForm.get('newPassword')?.dirty ||
              ResetPassForm.get('newPassword')?.touched)) {
              <p
                class="peer-focus:text-black text-red-700 text-xs first-letter:uppercase"
              >
                @if(ResetPassForm.get('newPassword')?.getError('atLeastOneLetter')){
                <span>at least 1 letter, </span>
                } @if(ResetPassForm.get('newPassword')?.getError('atLeastOneNumber')){
                <span>a number </span>
                } @if(ResetPassForm.get('newPassword')?.getError('minLength')){
                <span>at least 8 chars</span>
                }
              </p>
              }
            </div>
          <button
            class="text-center block w-full rounded-full py-2.5 font-bold text-white bg-[#3665f3] hover:bg-[#0F2796] disabled:bg-[#c7c7c7] disabled:cursor-not-allowed"
            type="submit"
            [disabled]="emailValidation.invalid && !isLoading"
          >
            Confirm
          </button>
          @if(isLoading()){
          <span class="block text-center mt-4">
            <i class="fa-solid fa-spinner fa-spin-pulse"></i>
          </span>
          } @else if (errorMsg()){
          <div
            class="p-4 mt-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400"
            role="alert"
          >
            {{ errorMsg() }}
          </div>
          } @else if (successMsg()) {
          <div
            class="p-4 mt-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400"
            role="alert"
          >
            email changed successful
          </div>
          }
        </form>
        }
      </div>
    </div>
  </div>
</section>
